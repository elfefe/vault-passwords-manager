<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Options - Vault Password Manager</title>
  <style>
    :root {
      --color-primary: #290873;
      --color-pink: #F72585;
      --color-violet: #7209B7;
      --color-blue: #4361EE;
      --color-light-blue: #4CC9E0;
      --color-dark-navy: #382E4D;
      --color-dark-gray: #504C59;
      --color-light-gray: #ECE9F2;
    }

    body { 
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Inter', 'Roboto', sans-serif;
      padding: 0;
      margin: 0;
      background: var(--color-light-gray);
      color: var(--color-dark-navy);
    }

    .header-gradient {
      background: linear-gradient(135deg, var(--color-primary), var(--color-violet), var(--color-pink));
      color: white;
      padding: 32px 24px;
      margin-bottom: 24px;
      box-shadow: 0 4px 12px rgba(114, 9, 183, 0.3);
    }

    .header-gradient h2 {
      margin: 0;
      font-size: 28px;
      font-weight: 700;
      letter-spacing: -0.02em;
    }

    .container {
      max-width: 800px;
      margin: 0 auto;
      padding: 0 24px 32px;
    }

    label { 
      display: block;
      margin-top: 16px;
      font-weight: 600;
      color: var(--color-dark-navy);
      font-size: 14px;
    }

    input[type="text"], input[type="password"], input[type="number"] { 
      width: 100%;
      padding: 12px 16px;
      box-sizing: border-box;
      border: 2px solid var(--color-light-gray);
      border-radius: 10px;
      font-size: 14px;
      font-weight: 500;
      color: var(--color-dark-navy);
      transition: all 0.2s ease;
    }

    input[type="text"]:focus, input[type="password"]:focus, input[type="number"]:focus {
      outline: none;
      border-color: var(--color-violet);
      box-shadow: 0 0 0 4px rgba(114, 9, 183, 0.15);
    }

    button { 
      margin-top: 16px;
      padding: 12px 20px;
      cursor: pointer;
      border: none;
      border-radius: 10px;
      background: linear-gradient(135deg, var(--color-pink), var(--color-violet));
      color: white;
      font-weight: 600;
      font-size: 14px;
      transition: all 0.2s ease;
      box-shadow: 0 4px 8px rgba(247, 37, 133, 0.3);
    }

    button:hover { 
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(247, 37, 133, 0.4);
    }

    button.secondary { 
      background: var(--color-light-gray);
      color: var(--color-dark-navy);
      box-shadow: none;
    }

    button.secondary:hover { 
      background: #d5d0e0;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    button.warning { 
      background: linear-gradient(135deg, #f59e0b, #d97706);
      box-shadow: 0 4px 8px rgba(245, 158, 11, 0.3);
    }

    button.warning:hover { 
      box-shadow: 0 6px 12px rgba(245, 158, 11, 0.4);
    }

    button.danger { 
      background: linear-gradient(135deg, #ef4444, #dc2626);
      box-shadow: 0 4px 8px rgba(239, 68, 68, 0.3);
    }

    button.danger:hover { 
      box-shadow: 0 6px 12px rgba(239, 68, 68, 0.4);
    }

    .note { 
      margin-top: 12px;
      color: var(--color-dark-gray);
      font-size: 13px;
      line-height: 1.6;
    }

    .modal { 
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(41, 8, 115, 0.6);
      backdrop-filter: blur(4px);
      z-index: 1000;
    }

    .modal-content { 
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: white;
      padding: 32px;
      border-radius: 16px;
      min-width: 320px;
      max-width: 500px;
      box-shadow: 0 20px 40px rgba(114, 9, 183, 0.3);
      border: 2px solid var(--color-light-gray);
    }

    .modal.show { display: block; }

    .pin-input { 
      text-align: center;
      font-size: 28px;
      letter-spacing: 12px;
      font-family: 'SF Mono', 'Monaco', 'Courier New', monospace;
      font-weight: 700;
      color: var(--color-violet);
      border: 2px solid var(--color-light-gray) !important;
      padding: 16px !important;
    }

    .pin-input:focus {
      border-color: var(--color-violet) !important;
      box-shadow: 0 0 0 4px rgba(114, 9, 183, 0.15) !important;
    }

    .section { 
      margin-top: 24px;
      padding: 24px;
      border: 2px solid var(--color-light-gray);
      border-radius: 12px;
      background: white;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    }

    .section h3 { 
      margin-top: 0;
      font-size: 20px;
      font-weight: 700;
      background: linear-gradient(135deg, var(--color-violet), var(--color-pink));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .warning-box { 
      background: linear-gradient(135deg, #fef3c7, #fde68a);
      border-left: 4px solid #f59e0b;
      padding: 16px;
      margin: 16px 0;
      border-radius: 8px;
    }

    .warning-box strong { 
      color: #92400e;
      font-weight: 700;
    }

    .button-group { 
      display: flex;
      gap: 12px;
      margin-top: 16px;
      flex-wrap: wrap;
    }

    input[type="file"] { display: none; }

    .modal-content h3 {
      background: linear-gradient(135deg, var(--color-violet), var(--color-pink));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      font-weight: 700;
    }

    /* PIN Input Container with Toggle Button */
    .pin-input-container {
      position: relative;
      display: flex;
      align-items: center;
    }

    .pin-input-container .pin-input {
      padding-right: 50px !important;
    }

    .pin-toggle-btn {
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
      background: transparent;
      border: none;
      color: var(--color-dark-gray);
      cursor: pointer;
      padding: 8px;
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
    }

    .pin-toggle-btn:hover {
      background: rgba(114, 9, 183, 0.1);
      color: var(--color-violet);
    }

    .pin-toggle-btn svg {
      width: 18px;
      height: 18px;
    }
  </style>
</head>
<body>
  <div class="header-gradient">
    <h2>‚öôÔ∏è Configuration Vault</h2>
  </div>
  <div class="container">
  <label>URL du Vault</label>
  <input id="vaultUrl" type="text" placeholder="https://vault.exem.fr/" value="https://vault.exem.fr/" />
  <label>Mount path KV</label>
  <input id="kvMount" type="text" placeholder="passwords" value="passwords"/>
  <div style="margin-top: 16px;">
    <p style="font-weight: 500; margin-bottom: 8px;">Authentification</p>
    <p style="font-size: 0.9em; color: #6b7280; margin-bottom: 12px;">Connectez-vous avec Google pour obtenir votre token Vault</p>
    <div id="googleSignInButton" style="display: flex; justify-content: center; margin-bottom: 16px;"></div>
    <div style="text-align: center; color: #6b7280; font-size: 0.9em; margin: 16px 0;">ou</div>
    <label>Token Vault (manuel)</label>
    <input id="vaultToken" type="password" placeholder="s.xxxxxx" />
  </div>
  <button id="saveBtn">Enregistrer et authentifier</button>
  <button id="clearBtn" class="secondary">R√©initialiser</button>
  <p class="note">
    Le token sera chiffr√© avec une cl√© d'authentification rapide (4 chiffres) que vous devrez cr√©er.
  </p>

  <!-- Section Master Key -->
  <div class="section">
    <h3>üîê Gestion du Mot de passe Master Key</h3>
    <p style="font-size: 0.9em; color: #6b7280; margin-bottom: 12px;">
      Le mot de passe Master Key est utilis√© pour d√©river la cl√© de chiffrement de tous vos secrets. Vous pouvez l'exporter pour la sauvegarder ou l'importer pour restaurer vos secrets.
    </p>
    
    <div class="warning-box">
      <strong>‚ö†Ô∏è Important :</strong> Le mot de passe Master Key est hautement sensible. Stockez-le dans un endroit s√ªr et ne le partagez jamais.
    </div>

    <div class="button-group">
      <button id="exportMasterKeyBtn" class="warning">üì• Exporter le mot de passe</button>
      <button id="importMasterKeyBtn" class="warning">üì§ Importer le mot de passe</button>
    </div>
    <input type="file" id="importMasterKeyFile" accept=".txt,.key" />
    
    <p id="masterKeyStatus" style="margin-top: 12px; font-size: 0.9em; color: #6b7280;"></p>
  </div>

  <!-- Section Synchronisation Chrome -->
  <div class="section">
    <h3>‚òÅÔ∏è Synchronisation Chrome Automatique</h3>
    <p style="font-size: 0.9em; color: #6b7280; margin-bottom: 12px;">
      Synchronisez automatiquement votre Master Key entre tous vos appareils Chrome connect√©s √† votre compte Google.
    </p>
    
    <div style="background: #dbeafe; border-left: 4px solid #3b82f6; padding: 12px; margin: 12px 0; border-radius: 4px;">
      <strong>‚ú® Avantages :</strong>
      <ul style="margin: 8px 0 0 20px; font-size: 0.9em;">
        <li>‚úÖ Synchronisation automatique instantan√©e</li>
        <li>‚úÖ Aucune configuration suppl√©mentaire</li>
        <li>‚úÖ Master Key toujours chiffr√©e par votre PIN</li>
        <li>‚úÖ Acc√©dez √† vos secrets sur tous vos appareils Chrome</li>
      </ul>
    </div>

    <div style="margin: 16px 0;">
      <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
        <input type="checkbox" id="syncEnabledCheckbox" style="width: auto; cursor: pointer;" />
        <span>Activer la synchronisation Chrome</span>
      </label>
      <p style="font-size: 0.8em; color: #6b7280; margin-top: 4px; margin-left: 24px;">
        Votre Master Key sera synchronis√©e via votre compte Google Chrome (toujours chiffr√©e)
      </p>
    </div>
    
    <p id="syncStatus" style="margin-top: 12px; font-size: 0.9em; color: #6b7280;"></p>
  </div>

  <!-- Section Import/Export Cat√©gories et Secrets -->
  <div class="section">
    <h3>üì¶ Import/Export des Cat√©gories et Secrets</h3>
    <p style="font-size: 0.9em; color: #6b7280; margin-bottom: 12px;">
      Exportez toutes vos cat√©gories et leurs secrets pour cr√©er une sauvegarde, ou importez-les pour restaurer vos donn√©es.
    </p>
    
    <div class="warning-box">
      <strong>‚ö†Ô∏è Important :</strong> Les secrets export√©s sont d√©chiffr√©s. Stockez le fichier d'export dans un endroit s√ªr et ne le partagez jamais. L'import remplacera toutes vos cat√©gories et secrets existants.
    </div>

    <div class="button-group">
      <button id="exportCategoriesBtn" class="warning">üì• Exporter toutes les cat√©gories</button>
      <button id="importCategoriesBtn" class="warning">üì§ Importer des cat√©gories</button>
    </div>
    <input type="file" id="importCategoriesFile" accept=".json" />
    
    <p id="categoriesStatus" style="margin-top: 12px; font-size: 0.9em; color: #6b7280;"></p>
  </div>
  
  <!-- Modal pour cr√©er la cl√© d'authentification rapide -->
  <div id="pinModal" class="modal">
    <div class="modal-content">
      <h3>Cr√©er une cl√© d'authentification rapide</h3>
      <p>Entrez un code √† 4 chiffres pour s√©curiser votre token Vault.</p>
      <div class="pin-input-container">
        <input id="pinInput" type="password" class="pin-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢" maxlength="4" />
        <button type="button" class="pin-toggle-btn" id="togglePinInput" title="Afficher le PIN">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
            <circle cx="12" cy="12" r="3"></circle>
          </svg>
        </button>
      </div>
      <div class="pin-input-container" style="margin-top: 12px;">
        <input id="pinConfirm" type="password" class="pin-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢" maxlength="4" />
        <button type="button" class="pin-toggle-btn" id="togglePinConfirm" title="Afficher le PIN">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
            <circle cx="12" cy="12" r="3"></circle>
          </svg>
        </button>
      </div>
      <div style="margin-top: 16px; display: flex; gap: 8px;">
        <button id="pinSaveBtn" style="flex: 1;">Enregistrer</button>
        <button id="pinCancelBtn" class="secondary" style="flex: 1;">Annuler</button>
      </div>
      <p id="pinError" style="color: red; font-size: 0.9em; margin-top: 8px; display: none;"></p>
    </div>
  </div>

  <!-- Modal pour demander le PIN (export/import) -->
  <div id="pinPromptModal" class="modal">
    <div class="modal-content">
      <h3 id="pinPromptTitle">Authentification requise</h3>
      <p id="pinPromptMessage">Entrez votre code √† 4 chiffres</p>
      <input id="pinPromptInput" type="password" class="pin-input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢" maxlength="4" />
      <div style="margin-top: 16px; display: flex; gap: 8px;">
        <button id="pinPromptOkBtn" style="flex: 1;">Valider</button>
        <button id="pinPromptCancelBtn" class="secondary" style="flex: 1;">Annuler</button>
      </div>
      <p id="pinPromptError" style="color: red; font-size: 0.9em; margin-top: 8px; display: none;"></p>
    </div>
  </div>

  <!-- Modal pour cr√©er le mot de passe Master Key -->
  <div id="passwordModal" class="modal">
    <div class="modal-content">
      <h3>Cr√©er votre mot de passe Master Key</h3>
      <p style="font-size: 0.9em; color: #6b7280; margin-bottom: 12px;">
        Ce mot de passe sera utilis√© pour d√©river la cl√© de chiffrement de tous vos secrets. 
        Choisissez un mot de passe fort et s√©curis√©.
      </p>
      <label style="margin-top: 0;">Mot de passe</label>
      <div class="pin-input-container">
        <input id="passwordInput" type="password" style="width: 100%; padding: 12px 16px; box-sizing: border-box; border: 2px solid var(--color-light-gray); border-radius: 10px; font-size: 14px;" placeholder="Entrez votre mot de passe" />
        <button type="button" class="pin-toggle-btn" id="togglePasswordInput" title="Afficher le mot de passe">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
            <circle cx="12" cy="12" r="3"></circle>
          </svg>
        </button>
      </div>
      <label style="margin-top: 12px;">Confirmer le mot de passe</label>
      <div class="pin-input-container">
        <input id="passwordConfirm" type="password" style="width: 100%; padding: 12px 16px; box-sizing: border-box; border: 2px solid var(--color-light-gray); border-radius: 10px; font-size: 14px;" placeholder="Confirmez votre mot de passe" />
        <button type="button" class="pin-toggle-btn" id="togglePasswordConfirm" title="Afficher le mot de passe">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
            <circle cx="12" cy="12" r="3"></circle>
          </svg>
        </button>
      </div>
      <div style="background: #dbeafe; border-left: 4px solid #3b82f6; padding: 12px; margin: 12px 0; border-radius: 4px; font-size: 0.85em;">
        <strong>üí° Conseils pour un mot de passe s√©curis√© :</strong>
        <ul style="margin: 8px 0 0 20px;">
          <li>Au moins 12 caract√®res</li>
          <li>M√©langez majuscules, minuscules, chiffres et symboles</li>
          <li>N'utilisez pas de mots du dictionnaire</li>
          <li>Ne r√©utilisez pas ce mot de passe ailleurs</li>
        </ul>
      </div>
      <div style="margin-top: 16px; display: flex; gap: 8px;">
        <button id="passwordSaveBtn" style="flex: 1;">Enregistrer</button>
        <button id="passwordCancelBtn" class="secondary" style="flex: 1;">Annuler</button>
      </div>
      <p id="passwordError" style="color: red; font-size: 0.9em; margin-top: 8px; display: none;"></p>
    </div>
  </div>

  <!-- Modal pour demander le mot de passe Master Key -->
  <div id="passwordPromptModal" class="modal">
    <div class="modal-content">
      <h3 id="passwordPromptTitle">Mot de passe Master Key requis</h3>
      <p id="passwordPromptMessage">Entrez votre mot de passe Master Key</p>
      <div class="pin-input-container">
        <input id="passwordPromptInput" type="password" style="width: 100%; padding: 12px 16px; box-sizing: border-box; border: 2px solid var(--color-light-gray); border-radius: 10px; font-size: 14px;" placeholder="Entrez votre mot de passe" />
        <button type="button" class="pin-toggle-btn" id="togglePasswordPromptInput" title="Afficher le mot de passe">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
            <circle cx="12" cy="12" r="3"></circle>
          </svg>
        </button>
      </div>
      <div style="margin-top: 16px; display: flex; gap: 8px;">
        <button id="passwordPromptOkBtn" style="flex: 1;">Valider</button>
        <button id="passwordPromptCancelBtn" class="secondary" style="flex: 1;">Annuler</button>
      </div>
      <p id="passwordPromptError" style="color: red; font-size: 0.9em; margin-top: 8px; display: none;"></p>
    </div>
  </div>
  </div>
  
  <script src="lib/blake3.js"></script>
  <script src="lib/chacha20-poly1305.js"></script>
  <script src="crypto-utils.js"></script>
  <script src="crypto-system.js"></script>
  <script src="options.js"></script>
</body>
</html>

