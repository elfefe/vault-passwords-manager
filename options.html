<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Options - Vault Password Manager</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 16px; max-width: 720px; }
    label { display:block; margin-top:12px; font-weight: 500; }
    input[type="text"], input[type="password"], input[type="number"] { width:100%; padding:8px; box-sizing:border-box; border: 1px solid #ddd; border-radius: 4px; }
    button { margin-top:12px; padding:8px 12px; cursor: pointer; border: 1px solid #ddd; border-radius: 4px; background: #3b82f6; color: white; }
    button:hover { background: #2563eb; }
    button.secondary { background: #6b7280; }
    button.secondary:hover { background: #4b5563; }
    button.warning { background: #f59e0b; }
    button.warning:hover { background: #d97706; }
    button.danger { background: #dc2626; }
    button.danger:hover { background: #b91c1c; }
    .note { margin-top:8px; color: #444; font-size:0.9em; }
    .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; }
    .modal-content { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; padding: 24px; border-radius: 8px; min-width: 300px; max-width: 500px; }
    .modal.show { display: block; }
    .pin-input { text-align: center; font-size: 24px; letter-spacing: 8px; font-family: monospace; }
    .section { margin-top: 32px; padding: 20px; border: 2px solid #e5e7eb; border-radius: 8px; }
    .section h3 { margin-top: 0; color: #1f2937; }
    .warning-box { background: #fef3c7; border-left: 4px solid #f59e0b; padding: 12px; margin: 12px 0; border-radius: 4px; }
    .warning-box strong { color: #92400e; }
    .button-group { display: flex; gap: 8px; margin-top: 12px; }
    input[type="file"] { display: none; }
  </style>
</head>
<body>
  <h2>Configuration Vault</h2>
  <label>URL du Vault</label>
  <input id="vaultUrl" type="text" placeholder="https://vault.exem.fr/" value="https://vault.exem.fr/" />
  <label>Mount path KV</label>
  <input id="kvMount" type="text" placeholder="passwords" value="passwords"/>
  <div style="margin-top: 16px;">
    <p style="font-weight: 500; margin-bottom: 8px;">Authentification</p>
    <p style="font-size: 0.9em; color: #6b7280; margin-bottom: 12px;">Connectez-vous avec Google pour obtenir votre token Vault</p>
    <div id="googleSignInButton" style="display: flex; justify-content: center; margin-bottom: 16px;"></div>
    <div style="text-align: center; color: #6b7280; font-size: 0.9em; margin: 16px 0;">ou</div>
    <label>Token Vault (manuel)</label>
    <input id="vaultToken" type="password" placeholder="s.xxxxxx" />
  </div>
  <button id="saveBtn">Enregistrer et authentifier</button>
  <button id="clearBtn" class="secondary">R√©initialiser</button>
  <p class="note">
    Le token sera chiffr√© avec une cl√© d'authentification rapide (4 chiffres) que vous devrez cr√©er.
  </p>

  <!-- Section Master Key -->
  <div class="section">
    <h3>üîê Gestion de la Master Key</h3>
    <p style="font-size: 0.9em; color: #6b7280; margin-bottom: 12px;">
      La Master Key est utilis√©e pour chiffrer tous vos secrets. Vous pouvez l'exporter pour la sauvegarder ou l'importer pour restaurer vos secrets.
    </p>
    
    <div class="warning-box">
      <strong>‚ö†Ô∏è Important :</strong> La Master Key est hautement sensible. Stockez-la dans un endroit s√ªr et ne la partagez jamais.
    </div>

    <div class="button-group">
      <button id="exportMasterKeyBtn" class="warning">üì• T√©l√©charger Master Key</button>
      <button id="importMasterKeyBtn" class="warning">üì§ Importer Master Key</button>
    </div>
    <input type="file" id="importMasterKeyFile" accept=".txt,.key" />
    
    <p id="masterKeyStatus" style="margin-top: 12px; font-size: 0.9em; color: #6b7280;"></p>
  </div>

  <!-- Section Synchronisation Chrome -->
  <div class="section">
    <h3>‚òÅÔ∏è Synchronisation Chrome Automatique</h3>
    <p style="font-size: 0.9em; color: #6b7280; margin-bottom: 12px;">
      Synchronisez automatiquement votre Master Key entre tous vos appareils Chrome connect√©s √† votre compte Google.
    </p>
    
    <div style="background: #dbeafe; border-left: 4px solid #3b82f6; padding: 12px; margin: 12px 0; border-radius: 4px;">
      <strong>‚ú® Avantages :</strong>
      <ul style="margin: 8px 0 0 20px; font-size: 0.9em;">
        <li>‚úÖ Synchronisation automatique instantan√©e</li>
        <li>‚úÖ Aucune configuration suppl√©mentaire</li>
        <li>‚úÖ Master Key toujours chiffr√©e par votre PIN</li>
        <li>‚úÖ Acc√©dez √† vos secrets sur tous vos appareils Chrome</li>
      </ul>
    </div>

    <div style="margin: 16px 0;">
      <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
        <input type="checkbox" id="syncEnabledCheckbox" style="width: auto; cursor: pointer;" />
        <span>Activer la synchronisation Chrome</span>
      </label>
      <p style="font-size: 0.8em; color: #6b7280; margin-top: 4px; margin-left: 24px;">
        Votre Master Key sera synchronis√©e via votre compte Google Chrome (toujours chiffr√©e)
      </p>
    </div>
    
    <p id="syncStatus" style="margin-top: 12px; font-size: 0.9em; color: #6b7280;"></p>
  </div>
  
  <!-- Modal pour cr√©er la cl√© d'authentification rapide -->
  <div id="pinModal" class="modal">
    <div class="modal-content">
      <h3>Cr√©er une cl√© d'authentification rapide</h3>
      <p>Entrez un code √† 4 chiffres pour s√©curiser votre token Vault.</p>
      <input id="pinInput" type="number" class="pin-input" placeholder="0000" maxlength="4" min="0" max="9999" />
      <input id="pinConfirm" type="number" class="pin-input" placeholder="Confirmer" maxlength="4" min="0" max="9999" style="margin-top: 12px;" />
      <div style="margin-top: 16px; display: flex; gap: 8px;">
        <button id="pinSaveBtn" style="flex: 1;">Enregistrer</button>
        <button id="pinCancelBtn" class="secondary" style="flex: 1;">Annuler</button>
      </div>
      <p id="pinError" style="color: red; font-size: 0.9em; margin-top: 8px; display: none;"></p>
    </div>
  </div>

  <!-- Modal pour demander le PIN (export/import) -->
  <div id="pinPromptModal" class="modal">
    <div class="modal-content">
      <h3 id="pinPromptTitle">Authentification requise</h3>
      <p id="pinPromptMessage">Entrez votre code √† 4 chiffres</p>
      <input id="pinPromptInput" type="number" class="pin-input" placeholder="0000" maxlength="4" min="0" max="9999" />
      <div style="margin-top: 16px; display: flex; gap: 8px;">
        <button id="pinPromptOkBtn" style="flex: 1;">Valider</button>
        <button id="pinPromptCancelBtn" class="secondary" style="flex: 1;">Annuler</button>
      </div>
      <p id="pinPromptError" style="color: red; font-size: 0.9em; margin-top: 8px; display: none;"></p>
    </div>
  </div>
  
  <script src="lib/blake3.js"></script>
  <script src="lib/chacha20-poly1305.js"></script>
  <script src="crypto-utils.js"></script>
  <script src="crypto-system.js"></script>
  <script src="options.js"></script>
</body>
</html>

