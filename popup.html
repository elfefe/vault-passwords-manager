<!doctype html>
<html lang="fr">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Vault - Gestionnaire de Secrets</title>
  <link rel="stylesheet" href="popup.css" />
</head>

<body>
  <div class="container">
    <header>
      <div class="header-left">
        <div class="logo">V</div>
        <h1>Coffre</h1>
      </div>
      <div class="header-right">
        <button id="createBtn" class="btn-header btn-create">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="12" y1="5" x2="12" y2="19"></line>
            <line x1="5" y1="12" x2="19" y2="12"></line>
          </svg>
          Créer
        </button>
        <button id="typeBtn" class="btn-header btn-type">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="6 9 12 15 18 9"></polyline>
          </svg>
          Type
        </button>
      </div>
    </header>
    <div class="main-layout">
      <aside class="sidebar">
        <div class="search-container">
          <svg class="search-icon" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8"></circle>
            <path d="m21 21-4.35-4.35"></path>
          </svg>
          <input type="text" id="searchInput" placeholder="Rechercher" class="search-input">
        </div>
        <div class="category-container">
          <select id="categorySelect" class="category-select">
            <option value="">Chargement...</option>
          </select>
          <svg class="category-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="6 9 12 15 18 9"></polyline>
          </svg>
        </div>
        <div class="sidebar-actions">
          <button id="newCategoryBtn" class="btn-icon" title="Nouvelle catégorie">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="12" y1="5" x2="12" y2="19"></line>
              <line x1="5" y1="12" x2="19" y2="12"></line>
            </svg>
          </button>
          <button id="deleteCategoryBtn" class="btn-icon" title="Supprimer la catégorie">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="3 6 5 6 21 6"></polyline>
              <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
            </svg>
          </button>
        </div>
      </aside>
      <main class="content-area">
        <!-- Vue liste des cartes -->
        <div id="cardsView" class="view-container">
          <div id="cardsContainer" class="cards-container">
            <!-- Les cartes seront générées dynamiquement ici -->
          </div>
          <footer class="footer">
            <span id="itemsCount" class="items-count">0 éléments affichés</span>
            <div class="footer-actions">
              <button id="generateBtn" class="btn-footer">
                Générateur
              </button>
              <button id="settingsBtn" class="btn-footer">
                Paramètres
              </button>
            </div>
          </footer>
        </div>
        
        <!-- Vue détail du secret -->
        <div id="detailView" class="view-container" style="display: none;">
          <div class="detail-header">
            <button id="backBtn" class="btn-back">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="15 18 9 12 15 6"></polyline>
              </svg>
              Retour
            </button>
            <input type="text" id="detailTitleInput" class="detail-title-input" placeholder="Nom du secret" value="Nouveau secret">
          </div>
          <div class="detail-content">
            <div class="table-header">
              <span class="table-title">Informations</span>
              <div class="table-actions">
                <button id="copyAllBtn" class="btn-icon" title="Copier tout">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                    <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                  </svg>
                </button>
                <button id="newEntryBtn" class="btn-icon" title="Nouvelle entrée">
                  <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <line x1="12" y1="5" x2="12" y2="19"></line>
                    <line x1="5" y1="12" x2="19" y2="12"></line>
                  </svg>
                </button>
              </div>
            </div>
            <div id="secretTableContainer" class="secret-table-container" style="display: block;">
              <table id="secretTable">
                <thead>
                  <tr>
                    <th>Clé</th>
                    <th>Valeur</th>
                    <th></th>
                  </tr>
                </thead>
                <tbody id="secretTableBody">
                </tbody>
              </table>
            </div>
            <div class="detail-actions">
              <button id="addFieldBtn" class="btn btn-sm btn-secondary">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <line x1="12" y1="5" x2="12" y2="19"></line>
                  <line x1="5" y1="12" x2="19" y2="12"></line>
                </svg>
                Ajouter champ
              </button>
              <button id="writeBtn" class="btn btn-sm btn-primary">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path>
                  <polyline points="17 21 17 13 7 13 7 21"></polyline>
                  <polyline points="7 3 7 8 15 8"></polyline>
                </svg>
                Sauvegarder
              </button>
              <button id="deleteBtn" class="btn btn-sm btn-danger">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <polyline points="3 6 5 6 21 6"></polyline>
                  <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                </svg>
                Supprimer
              </button>
            </div>
          </div>
        </div>
      </main>
    </div>
    <!-- Section cachée pour la compatibilité -->
    <div style="display: none;">
      <a id="optionsLink" href="#" title="Options" class="icon-btn"></a>
    </div>
    <div id="toast" class="toast"></div>

    <!-- Modal de configuration initiale -->
    <div id="setupModal" class="auth-modal">
      <div class="auth-modal-content">
        <h3>Configuration initiale</h3>
        <p>Connectez-vous avec votre compte Google pour obtenir un token Vault</p>
        
        <!-- Google Sign-In Button -->
        <div id="googleSignInButton" style="margin-top: 16px;"></div>
        
        <div style="margin: 16px 0; text-align: center; color: #9ca3af; font-size: 0.9em;">
          ou
        </div>
        
        <p style="margin-bottom: 8px; font-size: 0.9em; color: #6b7280;">Entrez manuellement votre token Vault</p>
        <input id="setupTokenInput" type="password" placeholder="s.xxxxxx"
          style="width: 100%; padding: 10px; border: 2px solid #e5e7eb; border-radius: 8px; font-size: 14px;" />
        <div style="margin-top: 12px; display: flex; gap: 8px;">
          <button id="setupTokenBtn" class="btn btn-primary" style="flex: 1;">Continuer</button>
        </div>
        <p id="setupError" style="color: #ef4444; font-size: 0.9em; margin-top: 8px; display: none;"></p>
      </div>
    </div>

    <!-- Modal de création de PIN -->
    <div id="createPinModal" class="auth-modal">
      <div class="auth-modal-content">
        <h3>Créer une clé d'authentification rapide</h3>
        <p>Entrez un code à 4 chiffres pour sécuriser votre token</p>
        <div class="pin-input-container">
          <input id="createPinInput" type="password" class="pin-input" placeholder="••••" maxlength="4" />
          <button type="button" class="pin-toggle-btn" id="toggleCreatePin" title="Afficher le PIN">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
              <circle cx="12" cy="12" r="3"></circle>
            </svg>
          </button>
        </div>
        <div class="pin-input-container" style="margin-top: 12px;">
          <input id="createPinConfirm" type="password" class="pin-input" placeholder="••••" maxlength="4" />
          <button type="button" class="pin-toggle-btn" id="toggleCreatePinConfirm" title="Afficher le PIN">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"></path>
              <circle cx="12" cy="12" r="3"></circle>
            </svg>
          </button>
        </div>
        <div style="margin-top: 16px; display: flex; gap: 8px;">
          <button id="createPinBtn" class="btn btn-primary" style="flex: 1;">Enregistrer</button>
        </div>
        <p id="createPinError" style="color: #ef4444; font-size: 0.9em; margin-top: 8px; display: none;"></p>
      </div>
    </div>

    <!-- Modal d'authentification rapide -->
    <div id="authModal" class="auth-modal">
      <div class="auth-modal-content">
        <h3>Authentification rapide</h3>
        <p>Entrez votre code à 4 chiffres</p>
        <input id="authPinInput" type="password" class="pin-input" placeholder="••••" maxlength="4" />
        <p id="authError" style="color: #ef4444; font-size: 0.9em; margin-top: 8px; display: none;"></p>
      </div>
    </div>
  </div>
  <script src="lib/blake3.js"></script>
  <script src="lib/chacha20-poly1305.js"></script>
  <script src="crypto-utils.js"></script>
  <script src="crypto-system.js"></script>
  <script src="popup.js"></script>
</body>

</html>